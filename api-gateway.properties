# Port for the API Gateway
server.port=8080

# Enable the Gateway to use the DiscoveryClient (Eureka to find services
spring.cloud.gateway.discovery.locator.enabled=false

# --- Route Definitions ---

# Route requests for the ingestion service
# All requests starting with /ingest/ will be routed to the service named 'ingestion-service' found in Eureka.
spring.cloud.gateway.routes[0].id=ingestion-service-route
spring.cloud.gateway.routes[0].uri=lb://ingestion-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/ingest/**

# Route requests for the mobile-api-service (currently handled by roadtraffic-app)
spring.cloud.gateway.routes[1].id=mobile-api-route
spring.cloud.gateway.routes[1].uri=lb://VERIFICATION-SERVICE
spring.cloud.gateway.routes[1].predicates[0]=Path=/mobile/v1/**, /auth/**
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/mobile/v1/(?<segment>.*), /api/v1/mobile/${segment}

# Route requests for the verification service
spring.cloud.gateway.routes[2].id=verification-service-route
spring.cloud.gateway.routes[2].uri=lb://VERIFICATION-SERVICE
spring.cloud.gateway.routes[2].predicates[0]=Path=/verification/**
spring.cloud.gateway.routes[2].filters[0]=RewritePath=/verification/(?<segment>.*), /${segment}

# Actuator Configuration
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

# Eureka Client Configuration
eureka.client.serviceUrl.defaultZone=http://discovery-server:8761/eureka
eureka.client.enabled=true
